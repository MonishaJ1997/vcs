{% extends 'base.html' %}


{% block content %}

<div class="container-fluid mt-5 pt-4">
    <div class="row">

        <!-- ================= SIDEBAR ================= -->
        <div class="col-lg-3 mb-4">
            <div class="sidebar p-4 shadow-sm">
                <h5 class="fw-bold mb-3">Filters</h5>

                <form method="get">

                    <!-- Keyword Search -->
                    <label class="fw-semibold">Keyword</label>
                    <input type="text" name="keyword" class="form-control mb-3" 
                           value="{{ keyword|default:'' }}" placeholder="Job title or company">

                    <!-- Location Search -->
                    <label class="fw-semibold">Location</label>
                    <input type="text" name="location" class="form-control mb-3" 
                           value="{{ location|default:'' }}" placeholder="City, state...">

                    <hr>

                    <!-- Working Schedule -->
                    <label class="fw-semibold">Working Schedule</label>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="schedule" value="FT"
                               {% if 'FT' in schedules_selected %}checked{% endif %}>
                        <label class="form-check-label">Full time</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="schedule" value="PT"
                               {% if 'PT' in schedules_selected %}checked{% endif %}>
                        <label class="form-check-label">Part time</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="schedule" value="IN"
                               {% if 'IN' in schedules_selected %}checked{% endif %}>
                        <label class="form-check-label">Internship</label>
                    </div>

                    <hr>

                    <!-- Work Type -->
                    <label class="fw-semibold">Work Type</label>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="work_type" value="RM"
                               {% if 'RM' in work_types_selected %}checked{% endif %}>
                        <label class="form-check-label">Remote</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="work_type" value="HY"
                               {% if 'HY' in work_types_selected %}checked{% endif %}>
                        <label class="form-check-label">Hybrid</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="work_type" value="ON"
                               {% if 'ON' in work_types_selected %}checked{% endif %}>
                        <label class="form-check-label">Onsite</label>
                    </div>

                    <hr>

                    <!-- Salary --
                    <label class="fw-semibold">Salary</label>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="salary" value="lt20"
                               {% if 'lt20' in salaries_selected %}checked{% endif %}>
                        <label class="form-check-label">&lt; ₹20,000</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="salary" value="20to50"
                               {% if '20to50' in salaries_selected %}checked{% endif %}>
                        <label class="form-check-label">₹20,000 - ₹50,000</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="salary" value="gt50"
                               {% if 'gt50' in salaries_selected %}checked{% endif %}>
                        <label class="form-check-label">&gt; ₹50,000</label>
                    </div>-->

                    <button type="submit" class="btn btn-primary mt-3 w-100">Apply Filters</button>
                </form>
            </div>
        </div>

        <!-- ================= JOB LIST ================= -->
        <div class="col-lg-9">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h3 class="fw-bold">Recommended Jobs</h3>
            </div>

            <div class="row g-4">
                {% for job in jobs %}
                <div class="col-md-6 col-xl-4">
                    <div class="job-card-modern card-blue p-4 h-100">

                        <div class="mb-3">
                            <h5 class="fw-bold">{{ job.title }}</h5>
                            <p class="text-muted mb-1">{{ job.company }}</p>
                            <p class="small text-secondary">
                                {{ job.location }} • {{ job.experience }} • 
                                {% if job.salary %}
                                    {{ job.salary }}
                                {% else %}
                                    Not Specified
                                {% endif %}
                            </p>
                        </div>

                        <div class="mt-auto d-flex justify-content-between align-items-center">

                            <a href="{% url 'jobs:job_detail' job.id %}" 
                               class="btn btn-primary btn-sm px-3 rounded-pill">Details</a>

                            <button class="btn btn-light border save-job-btn" data-job="{{ job.id }}">
                                {% if job.id in saved_jobs %}
                                    <i class="bi bi-bookmark-fill"></i>
                                {% else %}
                                    <i class="bi bi-bookmark"></i>
                                {% endif %}
                            </button>

                        </div>
                    </div>
                </div>
                {% empty %}
                <p class="text-center">No jobs available</p>
                {% endfor %}
            </div>

            <!-- Pagination -->
            {% if jobs.has_other_pages %}
            <nav aria-label="Job pagination">
                <ul class="pagination justify-content-center mt-4">
                    {% if jobs.has_previous %}
                    <li class="page-item">
                        <a class="page-link" href="?page={{ jobs.previous_page_number }}">Previous</a>
                    </li>
                    {% else %}
                    <li class="page-item disabled"><span class="page-link">Previous</span></li>
                    {% endif %}

                    {% for num in jobs.paginator.page_range %}
                        {% if jobs.number == num %}
                            <li class="page-item active"><span class="page-link">{{ num }}</span></li>
                        {% elif num > jobs.number|add:'-3' and num < jobs.number|add:'3' %}
                            <li class="page-item"><a class="page-link" href="?page={{ num }}">{{ num }}</a></li>
                        {% endif %}
                    {% endfor %}

                    {% if jobs.has_next %}
                    <li class="page-item">
                        <a class="page-link" href="?page={{ jobs.next_page_number }}">Next</a>
                    </li>
                    {% else %}
                    <li class="page-item disabled"><span class="page-link">Next</span></li>
                    {% endif %}
                </ul>
            </nav>
            {% endif %}

        </div>
    </div>
</div>

<!-- ================= AJAX SAVE JOB ================= -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
$(document).on('click','.save-job-btn',function(){
    let btn=$(this);
    let job_id=btn.data('job');
    $.ajax({
        url:"{% url 'jobs:save_job' %}",
        type:"POST",
        data:{
            job_id:job_id,
            csrfmiddlewaretoken:'{{ csrf_token }}'
        },
        success:function(res){
            if(res.status==='saved'){
                btn.html('<i class="bi bi-bookmark-fill"></i>');
            } else {
                btn.html('<i class="bi bi-bookmark"></i>');
            }
        }
    });
});
</script>

<!-- ================= STYLES ================= -->
<style>
body { background:#f5f7fb; }
.sidebar{ background:#f6f7f9; border-radius:18px; border:1px solid #e5e7eb; }
.job-card-modern{ border-radius:20px; border:1px solid #e5e7eb; display:flex; flex-direction:column; transition:0.3s; }
.job-card-modern:hover{ transform:translateY(-5px); box-shadow:0 12px 28px rgba(0,0,0,0.06); }
.card-blue{ background:#e3f0fb; }
.btn-primary{ background:#2563eb; border:none; }
.btn-primary:hover{ background:#1e4db7; }
.save-job-btn{ width:40px; height:40px; display:flex; align-items:center; justify-content:center; border-radius:50%; color:#2563eb; }
@media(max-width:992px){ .sidebar{ margin-bottom:20px; } }
</style>

{% endblock %}
